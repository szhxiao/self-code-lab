# 第 22 章 软件安装：源码与 Tarball

## 22.1 开放源码的软件安装与升级简介

### 22.1.1 什么是开放源码、编译程序与可执行文件

-   开放源码：程序代码，写给人看的程序语言，机器并不认识，无法执行；
-   编译程序：将程序代码转译成为机器看得懂的语言；
-   可执行文件：经过编译程序变成二进制程序拍机器看得懂且可执行的文件。

### 22.1.2 什么是函数库

### 22.1.3 什么是 make 与 configure

### 22.1.4 什么是 Tarball 的软件

Tarball 软件，是将软件的所有源码文件先以 tar 打包，然后再以压缩技术压缩。

### 22.1.5 如何安装与升级软件

基本流程：

-   将 Tarball 由厂商的网页下载下来；
-   将 Tarball 解压缩，生成很多的源码文件；
-   开始以 gcc 进行源码编译（会生成目标文件）；
-   以 gcc 进行函数库、主程序、子程序的链接，形成主要的二进制文件；
-   将二进制文件及相关配置文件安装至主机。

## 22.2 使用传统程序语言进行编译的简单范例

### 22.2.1 单一程序：打印 Hello World

### 22.2.2 主程序、子程序链接：子程序编译

1. 编写所需要的主程序、子程序

2. 进行程序的编译与链接

### 22.2.3 调用外部函数库：加入链接的函数库

### 22.2.4 gcc 的简易用法（编译、参数与链接）

## 22.3 用 make 进行宏编译

### 22.3.1 为什么要用 make

### 22.3.2 makefile 的基本语法与变量

```
目标(target): 目标文件1 目标文件2
    gcc -o 欲新建的可执行文件 目标文件1 目标文件2
```

makefile 基本规则：

-   `#`代表批注
-   \<tab\>需要在命令行的第一个字符
-   目标与相关文件之间需以`:`隔开

变量基本语法：

-   变量与变量内容以`=`隔开，同时两边可以具有空格
-   变量左边不能有`<tab>`
-   变量与变量内容在`=`两边不能有`:`
-   在习惯上，变量最好以大写字母为主
-   运用变量时，以`${变量}`或`$(变量)`使用
-   在该 shell 的环境变量是可以被套用的
-   在命令行模式也可以定义变量

环境变量取胜规则：

-   make 命令行后面加上的环境变量为第一优先
-   makefile 里面指定的环境变量第二优先
-   shell 原本具有的变量第三优先

## 22.4 Tarball 的管理与建议

### 22.4.1 使用源码管理软件所需要的基础软件

### 22.4.2 Tarball 安装的基本步骤

安装的基础操作：

-   取得源文件
-   取得步骤流程
-   相关属性软件安装
-   建立 makefile
-   编译
-   安装

### 22.4.3 一般 Tarball 软件安装的建议事项（如何删除、升级）

### 22.4.4 一个简单的范例

### 22.4.5 利用 patch 更新源码

## 22.5 函数库管理

### 22.5.1 动态与静态函数库

1. 静态函数库的特色

    - 扩展名
    - 编译行为
    - 独立执行的状态
    - 升级难易度

2. 动态函数库的特色

    - 扩展名
    - 编译行为
    - 独立执行的状态
    - 升级难易度

### 22.5.2 ldconfig 与/etc/ld.so.conf

> ldconfig [-f conf] [-C cache]

参数：

-   -f conf conf 指某个文件名
-   -C cache 使用 cache 作为缓存暂存

### 22.5.3 程序的动态函数库解析：ldd

> ldd [-vdr] [filename]

参数：

-   -v 列出所有内容信息
-   -d 重新将数据有丢失的 link 点显示出来
-   -r 将 ELF 有关的错误内容显示出来

## 22.6 检验软件正确性
