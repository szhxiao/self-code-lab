# 第 19 章 认识与分析日志文件

## 19.1 什么是日志文件

1. 日志文件的重要性

    - 解决系统方面的错误
    - 解决网络服务的问题
    - 过往事件记录簿

2. 常见的日志文件名

    - /var/log/cron
    - /var/log/dmesg

        记录系统开机时内核检测过程所产生的信息

    - /var/log/lastlog

        最近一次登录系统时的信息

    - /var/log/maillog 或/var/log/mail/\*
    - /var/log/messages

        系统发生的错误信息

    - /var/log/secure

3. 日志文件所需相关服务与进程

    日志文件需要的服务与程序：

    - syslogd

        主要登录系统与网络服务的信息

    - klogd

        主要登录内核产生的各项信息

    - logrotate

        主要进行日志文件的轮替功能

## 19.2 记录日志文件的服务

> ps aux | grep syslog

### 19.2.1 日志文件内容的一般格式

每条日志信息记录的重要数据：

-   事件发生的日期与时间
-   发生事件的主机名
-   启动此事件的服务名称或函数名称
-   信息的实际数据内容

### 19.2.2 syslog 的配置文件

1. 服务名称

    | 服务类型                  | 说明                                        |
    | ------------------------- | ------------------------------------------- |
    | auth(authpriv)            | 与认证有关的机制                            |
    | cron                      | 例行性工作调度 cron/at 等生成信息日志的地方 |
    | daemon                    | 与各个 daemon 有关的信息                    |
    | kern                      | 内核产生信息的地方                          |
    | lpr                       | 打印相关的信息                              |
    | mail                      | 与邮件收发有关的信息                        |
    | news                      | 与新闻服务器有关的信息                      |
    | syslog                    | syslogd 程序本身生成的信息                  |
    | user, uucp, local0~local7 | 与机器有关的信息                            |

2. 信息等级

    | 等级 | 等级名称 | 说明                           |
    | ---- | -------- | ------------------------------ |
    | 1    | info     | 基本信息说明                   |
    | 2    | notice   | 除 info 外还需要注意的信息内容 |
    | 3    | warning  | 警示信息                       |
    | 4    | err      | 重大错误信息                   |
    | 5    | crit     | 比 error 严重的错误信息        |
    | 6    | alert    | 警告，比 crit 更严重           |
    | 7    | emerg    | 系统几乎要死机                 |

3. 信息记录的文件名或设备、主机

### 19.2.3 日志文件的安全性设置

设置日志文件仅能被增加，而不能被删除：

> chattr +a /var/log/messages
> lsattr /var/log/messages

### 19.2.4 日志文件服务器的设置

## 19.3 日志文件的轮替

### 19.3.1 logrotate 的配置文件

### 19.3.2 实际测试 logrotate 的操作

### 19.3.3 自定义日志文件的轮替功能

## 19.4 分析日志文件
